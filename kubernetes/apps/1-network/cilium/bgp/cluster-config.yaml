---
# Cilium BGP Cluster Configuration
# This configures BGP peering with FRR container for LoadBalancer advertisement
#
# Architecture: RouterOS (65000) ← BGP → FRR (65101) ← BGP → Cilium (4200000101)
#
# AS Numbering Scheme:
#   AS 65000 - RouterOS (backbone router)
#   AS 65101 - FRR (BGP gateway on each node)
#   AS 4200000101 - Cilium BGP Control Plane (internal)
#
apiVersion: cilium.io/v2
kind: CiliumBGPClusterConfig
metadata:
  name: cluster-101-bgp
spec:
  nodeSelector:
    matchLabels:
      # Apply to all nodes in the cluster
      kubernetes.io/os: linux
  bgpInstances:
    - name: cluster-101-instance
      localASN: 4200000101  # Internal ASN for Cilium
      peers:
        - name: frr-container-ipv4
          peerAddress: 192.168.250.254  # FRR veth interface IPv4
          peerASN: 65101  # FRR's ASN
          peerConfigRef:
            name: upstream-router-peer
        - name: frr-container-ipv6
          peerAddress: "fdae:6bef:5e65::1"  # FRR veth interface IPv6
          peerASN: 65101  # FRR's ASN
          peerConfigRef:
            name: upstream-router-peer-ipv6
