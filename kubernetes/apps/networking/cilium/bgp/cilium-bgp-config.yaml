---
# CiliumBGPPeerConfig for local Bird2 peering
# Uses MP-BGP over IPv6 localhost (::1) to exchange both IPv4 and IPv6 routes
apiVersion: cilium.io/v2alpha1
kind: CiliumBGPPeerConfig
metadata:
  name: frr-local-mpbgp
spec:
  timers:
    holdTimeSeconds: 9
    keepAliveTimeSeconds: 3
  gracefulRestart:
    enabled: true
    restartTimeSeconds: 120
  families:
  - afi: ipv4
    safi: unicast
    advertisements:
      matchLabels:
        advertise: "bgp"
  - afi: ipv6
    safi: unicast
    advertisements:
      matchLabels:
        advertise: "bgp"
---
# Advertise LoadBalancer Services
apiVersion: cilium.io/v2alpha1
kind: CiliumBGPAdvertisement
metadata:
  name: loadbalancer-services
  labels:
    advertise: "bgp"
spec:
  advertisements:
  - advertisementType: "Service"
    service:
      addresses:
      - LoadBalancerIP
      selector:
        matchLabels: {}
        matchExpressions:
        - key: "service.kubernetes.io/service-proxy-name"
          operator: "NotIn"
          values: ["kube-proxy"]
    attributes:
      communities:
        large: ["4200001000:0:200"] # Public
---
# Advertise Pod CIDRs (Optional/Internal)
apiVersion: cilium.io/v2alpha1
kind: CiliumBGPAdvertisement
metadata:
  name: pod-cidr
  labels:
    advertise: "bgp"
spec:
  advertisements:
  - advertisementType: "PodCIDR"
    attributes:
      communities:
        large: ["4200001000:0:100"] # Internal