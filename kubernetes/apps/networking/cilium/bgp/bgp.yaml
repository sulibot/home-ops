---
# Cilium BGP advertises Service LoadBalancer VIPs to local FRR
apiVersion: cilium.io/v2
kind: CiliumBGPAdvertisement
metadata:
  name: cilium-lb-vips
  labels:
    advertise: cilium-lb
spec:
  advertisements:
    - advertisementType: Service
      service:
        addresses:
          - LoadBalancerIP
      selector: {}
      attributes:
        communities:
          large:
            - "4200001000:0:200" # CL_K8S_PUBLIC

---
# Cilium BGP advertises Pod CIDRs to local FRR for upstream routing
apiVersion: cilium.io/v2
kind: CiliumBGPAdvertisement
metadata:
  name: cilium-pod-cidrs
  labels:
    advertise: cilium-pod
spec:
  advertisements:
    - advertisementType: "PodCIDR"
      attributes:
        communities:
          large:
            - "4200001000:0:100" # CL_K8S_INTERNAL

---
# MP-BGP Peer Configuration
# Single peer carries both IPv4 and IPv6 routes over IPv6 session
# NOTE: Each AFI/SAFI must appear only ONCE - use matchExpressions to select multiple advertisements
apiVersion: cilium.io/v2
kind: CiliumBGPPeerConfig
metadata:
  name: frr-local-mpbgp
spec:
  families:
    # IPv4 Unicast - Advertises both LoadBalancer IPs AND Pod CIDRs
    - afi: ipv4
      safi: unicast
      advertisements:
        matchExpressions:
          - key: advertise
            operator: In
            values:
              - cilium-lb
              - cilium-pod
    # IPv6 Unicast - Advertises both LoadBalancer IPs AND Pod CIDRs
    - afi: ipv6
      safi: unicast
      advertisements:
        matchExpressions:
          - key: advertise
            operator: In
            values:
              - cilium-lb
              - cilium-pod
