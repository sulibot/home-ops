---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: akeyless
  namespace: external-secrets
spec:
  chart:
    spec:
      chart: akeyless-secrets-injection
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: akeyless
        namespace: flux-system
      version: 1.12.1
  interval: 1h0m0s
  values:
    HPA:
      annotations: {}
      cpuAvgUtil: 50
      enabled: false
      maxReplicas: 14
      memAvgUtil: 50
      minReplicas: 1
    affinity: |
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            topologyKey: kubernetes.io/hostname
            labelSelector:
              matchLabels:
                app: {{ template "vault-secrets-webhook.name" . }}
                release: {{ .Release.Name }}
    containerSecurityContext: {}
    debug: false
    deployment:
      labels: {}
      securityContext: {}
    env:
      AKEYLESS_ACCESS_ID: ""
      AKEYLESS_ACCESS_TYPE: ""
      AKEYLESS_AGENT_LIMITS_CPU: 500m
      AKEYLESS_AGENT_LIMITS_MEM: 128Mi
      AKEYLESS_AGENT_REQUESTS_CPU: 250m
      AKEYLESS_AGENT_REQUESTS_MEM: 64Mi
      AKEYLESS_URL: https://vault.akeyless.io
    gatewayCert:
      tlsCertsSecretName: null
    image:
      agentImage: docker.registry-2.akeyless.io/k8s-secrets-sidecar
      pullPolicy: IfNotPresent
      repository: docker.registry-2.akeyless.io/k8s-webhook-server
    livenessProbe:
      failureThreshold: 5
      initialDelaySeconds: 10
      periodSeconds: 30
    nodeSelector: {}
    openshiftEnabled: false
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
    replicaCount: 2
    resources:
      limits:
        cpu: 0.5
        memory: 192Mi
      requests:
        cpu: 0.25
        memory: 128Mi
    restartRollout:
      enabled: false
      interval: 1m
    service:
      externalPort: 443
      internalPort: 8443
      labels: {}
      name: secrets-webhook
      type: ClusterIP
    serviceAccount:
      automountServiceAccountToken: true
      create: true
      labels: {}
    tolerations: []
