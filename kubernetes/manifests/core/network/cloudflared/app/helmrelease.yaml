---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cloudflared
  namespace: network
spec:
  interval: 1h
  chart:
    spec:
      chart: cloudflare-tunnel
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: cloudflare
        namespace: flux-system
      version: 0.3.2
  values:
    image:
      repository: cloudflare/cloudflared
      tag: "2025.10.0"
      pullPolicy: IfNotPresent
    extraArgs:
      - --edge-ip-version
      - "6"
    env:
      - name: TUNNEL_TRANSPORT_PROTOCOL
        value: "http2"
    cloudflare:
      account: 089ac5ef7a1525cb7d7129cdde5873cd
      enableWarp: false
      ingress:
        - hostname: plex.sulibot.com
          service: http://plex.default.svc.cluster.local:32400
        - hostname: overseerr.sulibot.com
          service: http://overseerr.default.svc.cluster.local:80
        - hostname: hello.sulibot.com
          service: hello_world
      secretName: cloudflared-secret
      tunnelId: 0977043f-80e9-4549-a6f0-0af145a17f27
      tunnelName: sulibot-tunnel
    fullnameOverride: ""
    imagePullSecrets: []
    nameOverride: ""
    nodeSelector: {}
    podAnnotations: {}
    podLabels: {}
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 65532
      runAsGroup: 65532
      fsGroup: 65532
      fsGroupChangePolicy: OnRootMismatch
    replicaCount: 2
    resources:
      requests:
        cpu: 10m
        memory: 64Mi
      limits:
        memory: 256Mi
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true
    serviceAccount:
      annotations: {}
      name: ""
    tolerations: []
    affinity: {}
    dnsConfig:
      options:
        - name: ndots
          value: "1"
        - name: single-request
        - name: single-request-reopen
