---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cnpg-cluster
  namespace: flux-system
spec:
  chart:
    spec:
      chart: cluster
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: cnpg
        namespace: flux-system
      version: 0.2.1
  install:
    createNamespace: true
  interval: 1h0m0s
  targetNamespace: cnpg-system
  values:
    backups:
      azure:
        connectionString: ""
        containerName: ""
        inheritFromAzureAD: false
        path: /
        serviceName: blob
        storageAccount: ""
        storageKey: ""
        storageSasToken: ""
      data:
        compression: gzip
        encryption: AES256
        jobs: 2
      destinationPath: ""
      enabled: false
      endpointCA:
        create: false
        key: ""
        name: ""
        value: ""
      endpointURL: ""
      google:
        applicationCredentials: ""
        bucket: ""
        gkeEnvironment: false
        path: /
      provider: s3
      retentionPolicy: 30d
      s3:
        accessKey: ""
        bucket: ""
        inheritFromIAMRole: false
        path: /
        region: ""
        secretKey: ""
      scheduledBackups:
      - backupOwnerReference: self
        method: barmanObjectStore
        name: daily-backup
        schedule: 0 0 0 * * *
      secret:
        create: true
        name: ""
      wal:
        compression: gzip
        encryption: AES256
        maxParallel: 1
    cluster:
      additionalLabels: {}
      affinity:
        topologyKey: topology.kubernetes.io/zone
      annotations: {}
      certificates: {}
      enablePDB: true
      enableSuperuserAccess: true
      imageCatalogRef: {}
      imageName: ""
      imagePullPolicy: IfNotPresent
      imagePullSecrets: []
      initdb: {}
      instances: 2
      logLevel: info
      monitoring:
        customQueries: []
        customQueriesSecret: []
        disableDefaultQueries: false
        enabled: false
        podMonitor:
          enabled: true
          metricRelabelings: []
          relabelings: []
        prometheusRule:
          enabled: true
          excludeRules: []
      postgresGID: -1
      postgresUID: -1
      postgresql:
        parameters: {}
        pg_hba: []
        pg_ident: []
        shared_preload_libraries: []
        synchronous: {}
      primaryUpdateMethod: switchover
      primaryUpdateStrategy: unsupervised
      priorityClassName: ""
      resources: {}
      roles: []
      serviceAccountTemplate: {}
      services: {}
      storage:
        size: 8Gi
        storageClass: cephfs-csi-sc-retain
      superuserSecret: ""
      walStorage:
        enabled: false
        size: 1Gi
        storageClass: ""
    fullnameOverride: ""
    imageCatalog:
      create: true
      images: []
    mode: standalone
    nameOverride: ""
    namespaceOverride: ""
    poolers: []
    recovery:
      azure:
        connectionString: ""
        containerName: ""
        inheritFromAzureAD: false
        path: /
        serviceName: blob
        storageAccount: ""
        storageKey: ""
        storageSasToken: ""
      backupName: ""
      clusterName: ""
      destinationPath: ""
      endpointCA:
        create: false
        key: ""
        name: ""
        value: ""
      endpointURL: ""
      google:
        applicationCredentials: ""
        bucket: ""
        gkeEnvironment: false
        path: /
      method: backup
      pgBaseBackup:
        database: app
        owner: ""
        secret: ""
        source:
          database: app
          host: ""
          passwordSecret:
            create: false
            key: password
            name: ""
            value: ""
          port: 5432
          sslCertSecret:
            key: ""
            name: ""
          sslKeySecret:
            key: ""
            name: ""
          sslMode: verify-full
          sslRootCertSecret:
            key: ""
            name: ""
          username: ""
      pitrTarget:
        time: ""
      provider: s3
      s3:
        accessKey: ""
        bucket: ""
        inheritFromIAMRole: false
        path: /
        region: ""
        secretKey: ""
      secret:
        create: true
        name: ""
    type: postgresql
    version:
      postgis: "3.4"
      postgresql: "16"
      timescaledb: "2.15"
