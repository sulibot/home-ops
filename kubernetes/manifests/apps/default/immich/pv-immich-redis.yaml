---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: immich-redis
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteMany
  csi:
    driver: cephfs.csi.ceph.com
    nodeStageSecretRef:
      name: csi-cephfs-secret
      namespace: ceph-csi
    volumeAttributes:
      clusterID: 407036f5-1f73-44ff-ba81-1f219b7a8a64
      # Use the main Kubernetes filesystem and let the driver create a subvolume.
      fsName: kubernetes
      # The volumeHandle is the name of the subvolume within the fsName.
    volumeHandle: immich-redis
    # The 'static' volume attribute tells the driver this is a pre-defined volume.
    static: "true"
  persistentVolumeReclaimPolicy: Retain
  # Use a distinct storageClassName for static volumes to avoid provisioner conflicts.
  storageClassName: cephfs-csi-sc-retain
