apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: prometheus-stack-grafana
  namespace: observability
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: prometheus-stack-grafana
    creationPolicy: Owner
  data:
    # 🔐 Grafana Admin Credentials
    - secretKey: admin-user
      remoteRef:
        key: prometheus-stack
        property: username
    - secretKey: admin-password
      remoteRef:
        key: prometheus-stack
        property: password

    # 🔐 Prometheus Remote Write Credentials (if applicable)
    - secretKey: remote-write-username
      remoteRef:
        key: prometheus-stack-remote-write
        property: username
    - secretKey: remote-write-password
      remoteRef:
        key: prometheus-stack-remote-write
        property: password

    # 🔐 Alertmanager API Keys (Ensure unique keys in 1Password)
    - secretKey: slack-api-url
      remoteRef:
        key: prometheus-stack-alertmanager
        property: slack-webhook-url
    - secretKey: pagerduty-key
      remoteRef:
        key: prometheus-stack-alertmanager
        property: pagerduty-integration-key
    - secretKey: webhook-url
      remoteRef:
        key: prometheus-stack-alertmanager
        property: generic-webhook-url
