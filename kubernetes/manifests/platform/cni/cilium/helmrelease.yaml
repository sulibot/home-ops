---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cilium
  namespace: kube-system
spec:
  chart:
    spec:
      chart: cilium
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: cilium
        namespace: flux-system
      version: 1.16.6
  interval: 1m0s
  targetNamespace: kube-system
  values:
    bgpControlPlane:
      enabled: true
    bpf:
      masquerade: true
    dashboards:
      annotations: {}
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      namespace: null
    enableIPv4Masquerade: true
    enableIPv6Masquerade: true
    enableMasqueradeRouteSource: false
    envoy:
      annotations: {}
      baseID: 0
      bootstrapConfigMap: null
      connectTimeoutSeconds: 2
      enabled: null
      extraArgs: []
      extraContainers: []
      extraEnv: []
      extraHostPathMounts: []
      extraVolumeMounts: []
      extraVolumes: []
      healthPort: 9878
      httpRetryCount: 3
      idleTimeoutDurationSeconds: 60
      image:
        digest: sha256:57a3aa6355a3223da360395e3a109802867ff635cb852aa0afe03ec7bf04e545
        override: null
        pullPolicy: IfNotPresent
        repository: quay.io/cilium/cilium-envoy
        tag: v1.31.5-1737535524-fe8efeb16a7d233bffd05af9ea53599340d3f18e
        useDigest: true
      initialFetchTimeoutSeconds: 30
      livenessProbe:
        failureThreshold: 10
        periodSeconds: 30
      log:
        accessLogBufferSize: 4096
        defaultLevel: null
        format: '[%Y-%m-%d %T.%e][%t][%l][%n] [%g:%#] %v'
        format_json: null
        path: ""
      maxConcurrentRetries: 128
      maxConnectionDurationSeconds: 0
      maxRequestsPerConnection: 0
      podAnnotations: {}
      podLabels: {}
      podSecurityContext:
        appArmorProfile:
          type: Unconfined
      readinessProbe:
        failureThreshold: 3
        periodSeconds: 30
      resources: {}
      rollOutPods: false
      securityContext:
        capabilities:
          envoy:
          - NET_ADMIN
          - SYS_ADMIN
          keepCapNetBindService: true
        privileged: false
        seLinuxOptions:
          level: s0
          type: spc_t
      startupProbe:
        failureThreshold: 105
        periodSeconds: 2
      terminationGracePeriodSeconds: 1
      updateStrategy:
        rollingUpdate:
          maxUnavailable: 2
        type: RollingUpdate
      xffNumTrustedHopsL7PolicyEgress: 0
      xffNumTrustedHopsL7PolicyIngress: 0
    gatewayAPI:
      enableAlpn: false
      enableAppProtocol: false
      enableProxyProtocol: false
      enabled: true
      externalTrafficPolicy: Cluster
      gatewayClass:
        create: true
      hostNetwork:
        enabled: false
        nodes:
          matchLabels: {}
      secretsNamespace:
        create: true
        name: cilium-secrets
        sync: true
      xffNumTrustedHops: 0
    hubble:
      enabled: true
      relay:
        enabled: true
      ui:
        enabled: true
    ingressController:
      default: false
      enableProxyProtocol: false
      enabled: true
      enforceHttps: true
      ingressLBAnnotationPrefixes:
      - lbipam.cilium.io
      - nodeipam.cilium.io
      - service.beta.kubernetes.io
      - service.kubernetes.io
      - cloud.google.com
      loadbalancerMode: dedicated
    ipam:
      mode: cluster-pool
      operator:
        clusterPoolIPv4MaskSize: 24
        clusterPoolIPv4PodCIDRList:
        - 10.244.0.0/16
        clusterPoolIPv6MaskSize: 64
        clusterPoolIPv6PodCIDRList:
        - fd00:101:244::/56
    ipv4:
      enabled: true
    ipv6:
      enabled: true
    k8sServiceHost: fd00:101::10
    k8sServicePort: 6443
    kubeConfigPath: ""
    kubeProxyReplacement: "true"
    l2NeighDiscovery:
      enabled: true
      refreshPeriod: 30s
    l2announcements:
      enabled: false
    l7Proxy: true
