---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cilium
  namespace: kube-system
spec:
  chart:
    spec:
      chart: cilium
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: cilium
        namespace: flux-system
      version: 1.16.6
  interval: 1m0s
  targetNamespace: kube-system
  values:
    bgpControlPlane:
      enabled: true
    bpf:
      masquerade: true
    dashboards:
      annotations: {}
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      namespace: null
    enableIPv4Masquerade: true
    enableIPv6Masquerade: true
    enableMasqueradeRouteSource: false
    envoy:
      enabled: true
      securityContext:
        capabilities:
          envoy:
          - NET_ADMIN
          - NET_BIND_SERVICE
          - PERFMON
          - BPF
          keepCapNetBindService: true
    gatewayAPI:
      enableAlpn: false
      enableAppProtocol: false
      enableProxyProtocol: false
      enabled: true
      externalTrafficPolicy: Cluster
      gatewayClass:
        create: auto
      hostNetwork:
        enabled: false
        nodes:
          matchLabels: {}
      secretsNamespace:
        create: true
        name: cilium-secrets
        sync: true
      xffNumTrustedHops: 0
    hubble:
      enabled: true
      relay:
        enabled: true
      ui:
        enabled: true
    ingressController:
      default: false
      enableProxyProtocol: false
      enabled: true
      enforceHttps: true
      ingressLBAnnotationPrefixes:
      - lbipam.cilium.io
      - nodeipam.cilium.io
      - service.beta.kubernetes.io
      - service.kubernetes.io
      - cloud.google.com
      loadbalancerMode: dedicated
    ipam:
      mode: cluster-pool
      operator:
        clusterPoolIPv4MaskSize: 24
        clusterPoolIPv4PodCIDRList:
        - 10.244.0.0/16
        clusterPoolIPv6MaskSize: 64
        clusterPoolIPv6PodCIDRList:
        - fd00:101:244::/56
    ipv4:
      enabled: true
    ipv6:
      enabled: true
    k8sServiceHost: fd00:101::10
    k8sServicePort: 6443
    kubeConfigPath: ""
    kubeProxyReplacement: "true"
    l2NeighDiscovery:
      enabled: true
      refreshPeriod: 30s
    l2announcements:
      enabled: false
    l7Proxy: true
    loadBalancer:
      l7:
        backend: envoy
