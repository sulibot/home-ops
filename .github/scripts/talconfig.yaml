# This is a template for talhelper.
# It uses values from a `talenv.sops.yaml` file to generate
# the final Talos machine configurations.

clusterName: "{{ .clusterName }}"
talosVersion: v1.7.0 # Or your desired version
kubernetesVersion: v1.30.0 # Or your desired version

# The VIP for the control plane.
endpoint: "{{ .endpoint }}"

# Disable kube-proxy because we are using Cilium.
proxy:
  disabled: true

# Define the dual-stack Pod and Service CIDRs for Kubernetes.
# These values are sourced from your Terraform configuration.
clusterPodNets:
  - "{{ .pods_ipv6 }}"
  - "{{ .pods_ipv4 }}"
clusterServiceNets:
  - "{{ .services_ipv6 }}"
  - "{{ .services_ipv4 }}"

# Define the nodes for the cluster.
# talhelper will iterate over the `nodes` list from your talenv file.
nodes:
  {{- range .nodes }}
  - hostname: {{ .hostname }}
    # The IP address used for Talos control plane communication.
    ipAddress: {{ .ipAddress }}
    controlPlane: {{ .controlPlane }}
    installDisk: /dev/sda
    # You can add node-specific network config here if needed.
  {{- end }}

# You can add global machine configuration patches here.