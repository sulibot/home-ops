# Proxmox SDN dnsmasq template for GUA Router Advertisements
# This file is used by Proxmox SDN to generate dnsmasq configuration
# Location: /var/lib/pve-cluster/sdn/dnsmasq.conf.child
# Managed by Ansible vnet_gua role - DO NOT EDIT MANUALLY

# Loop through every VNet managed by SDN
{% for vnet_id in vnet_gua_vnets %}
# vnet{{ vnet_id }} - Dynamic GUA advertisement using constructor
interface=vnet{{ vnet_id }}

# Enable Router Advertisements
enable-ra

# Quiet mode - prevents logging every RA
quiet-ra

# THE MAGIC: Constructor automatically discovers the GUA on the interface
# This watches vnet{{ vnet_id }} and advertises whatever GUA prefix is configured
dhcp-range=::,constructor:vnet{{ vnet_id }},ra-stateless,ra-names,64

# Stable Anycast DNS using Link-Local address
# This ensures DNS doesn't break when the GUA prefix rotates
dhcp-option=vnet{{ vnet_id }},option6:dns-server,[fe80::{{ vnet_id }}:fffe]

{% endfor %}
