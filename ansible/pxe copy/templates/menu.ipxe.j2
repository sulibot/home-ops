#!ipxe
# ---------------- PXE Boot Menu for RouterOS TFTP ----------------

# ----------- Base variables -----------
set debian_base       http://10.0.9.95/debian-installer/amd64
set cloudinit_base    http://10.0.9.95/proxmox/user-data

# ----------- iPXE Boot Menu -----------
menu PXE Boot Menu
item --gap --         Proxmox Nodes
item auto             🚀 Auto Boot (by MAC)
item pve01            💾 Install pve01
item pve02            💾 Install pve02
item pve03            💾 Install pve03
item pve04            💾 Install pve04
item netboot          📦 netboot.xyz
item shell            🛠️  iPXE Shell

choose target && goto ${target}

# ----------- Node-specific Boot Entries -----------
:pve01
echo 💾 Booting pve01...
kernel ${debian_base}/linux26 auto=true priority=critical url=${cloudinit_base}/pve01-user-data.yml
initrd ${debian_base}/initrd.gz
boot

:pve02
echo 💾 Booting pve02...
kernel ${debian_base}/linux26 auto=true priority=critical url=${cloudinit_base}/pve02-user-data.yml
initrd ${debian_base}/initrd.gz
boot

:pve03
echo 💾 Booting pve03...
kernel ${debian_base}/linux26 auto=true priority=critical url=${cloudinit_base}/pve03-user-data.yml
initrd ${debian_base}/initrd.gz
boot

:pve04
echo 💾 Booting pve04...
kernel ${debian_base}/linux26 auto=true priority=critical url=${cloudinit_base}/pve04-user-data.yml
initrd ${debian_base}/initrd.gz
boot

# ----------- MAC-based Auto Boot -----------
:auto
iseq ${net0/mac} 52:54:00:aa:bb:01 && goto pve01
iseq ${net0/mac} 52:54:00:aa:bb:02 && goto pve02
iseq ${net0/mac} 52:54:00:aa:bb:03 && goto pve03
iseq ${net0/mac} 52:54:00:aa:bb:04 && goto pve04
goto netboot

# ----------- Netboot.xyz Chainload -----------
:netboot
echo 📦 Launching netboot.xyz...
chain --replace https://boot.netboot.xyz/ipxe/netboot.xyz.efi

# ----------- iPXE Shell -----------
:shell
shell
